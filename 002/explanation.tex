\documentclass[main.tex]{subfiles}
\begin{document}

\begin{prob}{2}{Even Fibonacci numbers}
    \begin{problem}
        Each new term in the Fibonacci sequence is generated by adding the previous two terms. By starting with 1 and 2, the first 10 terms will be: $1$, $2$, $3$, $5$, $8$, $13$, $21$, $34$, $55$, $89$, ...
        By considering the terms in the Fibonacci sequence whose values do not exceed four million, find the sum of the even-valued terms.
    \end{problem}
    \begin{solutions}
        \begin{solution}{A naive solution}
            An input size of $p=4000000$ is small enough to let us get away with a naive solution.
            The naive solution, to check every Fibonnacci number, gives us an $O(N)$ runtime in the amount of Fibonacci numbers calculated.
            Because the terms of the Fibonacci sequence grow exponentially, that is an $O(\log(p))$ runtime solution.

            \begin{figure}[H]
                \lstinputlisting[language=c, firstline=15, lastline=33]{\sol{002}{c}/naive.c}
                \caption{A naive solution}
            \end{figure}

            \complexity{\log(p)}{1}
        \end{solution}
        \begin{solution}{A better solution in C}
            To optimise, need to use the fact that every third Fibonacci number is even.\propref{every-third-fibonacci-term-even}

            This means that we only have to sum every third fiboncci number smaller than $p$.
            Because of the closed form expression describing the Fibonacci sequence, the sum that we're looking for now looks like this:\propref{closed-form-expression-fibonacci-term}
            \[ \sum_{n=1}^{k}\frac{\Phi^{3n} - (-\Phi)^{-3n}}{\sqrt{5}} \]

            Here $k$ is the largest number such that $F_{3k} < p$ holds.
            Rewriting this gets us the sum of two geometric series:\prref{closed-form-expression-nth-term-of-geometric-series}
            \begin{align*}
                &= \frac{1}{\sqrt{5}}\left( \sum_{n=1}^{k}(\Phi^{3})^{n} - \sum_{n=1}^{k}(-\Phi^{3})^{n} \right)\\
                &= \frac{1}{\sqrt{5}}\left( \Phi^{3}\frac{1-\left(\Phi^{3}\right)^{k}}{1-\Phi^{3}} - \Phi^{-3}\frac{1-\left(-\Phi^{-3}\right)^{k}}{1+\Phi^{-3}} \right)
            \end{align*}

            Assuming that the $k$-th power can be computed in $\log(k)$ time, this entire expressions can be computed in $\log(k)$ time.
            All that's left now is to compute $k$.
            This can be done in constant time:
            \[ n(F_n) = \floor*{\frac{\ln{F_n \cdot \sqrt{5}}}{\ln{\Phi}+\frac{1}{2}}} \]

            \begin{figure}[H]
                \lstinputlisting[language=c, firstline=18, lastline=29]{\sol{002}{c}/solution.c}
                \caption{A better solution in C}
            \end{figure}

            Because $k$ is of the order $\log(p)$, the total runtime complexity of this solution is $\log\log(p)$.
            \complexity{\log\log(p)}{1}
          \end{solution}
    \end{solutions}
\end{prob}

\end{document}
