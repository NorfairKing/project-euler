\documentclass[main.tex]{subfiles}
\begin{document}

\begin{prob}{2}{Even Fibonacci numbers}
    \begin{problem}
        Each new term in the Fibonacci sequence is generated by adding the previous two terms. By starting with 1 and 2, the first 10 terms will be: $1$, $2$, $3$, $5$, $8$, $13$, $21$, $34$, $55$, $89$, ...
        By considering the terms in the Fibonacci sequence whose values do not exceed four million, find the sum of the even-valued terms.
    \end{problem}
    \begin{solutions}
        \begin{solution}{A naive solution}

            \TODO{ definition of Fibonacci series }
            An input size of $p=4000000$ is small enough to let us get away with a naive solution.
            The naive solution, to check every Fibonnacci number, gives us an $O(N)$ runtime in the amount of Fibonacci numbers calculated.
            Because the terms of the Fibonacci sequence grow exponentially, that is an $O(\log(p))$ runtime solution.

            \begin{figure}[H]
                \lstinputlisting[language=c, firstline=13, lastline=31]{\sol{002}{c}/naive.c}
                \caption{A naive solution}
            \end{figure}
        \end{solution}
        \begin{solution}{A better solution}

            To optimise, we first need to see that every third Fibonacci number is even.

            \begin{prop}
                Every third Fibonacci number is even, that is, for every $k$, $F_{3k+1}$ is even.
                \begin{proof}
                    \noindent
                    \begin{itemize}
                        \item Base case: $F_{1} = 0$ is even.
                        \item Inductive step: If $F_{3k+1}$ is even, then $F_{3k+4}$ is even.\\
                            \[
                                F_{3k+4} = F_{3k+3} + F_{3k+2} = 2F_{3k+2} + F_{3k+1}
                            \]
                            Because both $F_{3k+1}$ and $2F_{3k+2}$ are even, $F_{3k+4}$ must be even.
                    \end{itemize}
                \end{proof}
            \end{prop}

            This means that we only have to sum every third fiboncci number smaller than $p$:
            There is a closed form expression describing the Fibonacci sequence: \why

            \[ F_{n} = \frac{\Phi^{n} - (-\Phi)^{-n}}{\sqrt{5}} \]

            Here, $\Phi$ is the golden ratio $\frac{1+\sqrt{5}}{2}$.
            The sum that we're looking for now looks like this:

            \[ \sum_{n=1}^{k}\frac{\Phi^{3n} - (-\Phi)^{-3n}}{\sqrt{5}} \]

            Here $k$ is the largest number such that $F_{3k} < p$ holds.
            Rewriting this gets us the sum of two geometric series: \clarify{geometric series closed form}

            \begin{align*}
                &= \frac{1}{\sqrt{5}}\left( \sum_{n=1}^{k}(\Phi^{3})^{n} - \sum_{n=1}^{k}(-\Phi^{3})^{n} \right)\\
                &= \frac{1}{\sqrt{5}}\left( \Phi^{3}\frac{1-\left(\Phi^{3}\right)^{k}}{1-\Phi^{3}} - \Phi^{-3}\frac{1-\left(-\Phi^{-3}\right)^{k}}{1+\Phi^{-3}} \right)
            \end{align*}

            Assuming that the $k$-th power can be computed in $\log(k)$ time, this entire expressions can be computed in $\log(k)$ time.
            All that's left now is to compute $k$.
            This can be done in constant time:
            \[ n(F_n) = \floor*{\frac{\ln{F_n \cdot \sqrt{5}}}{\ln{\Phi}+\frac{1}{2}}} \]

            \begin{figure}[H]
                \lstinputlisting[language=c, firstline=16, lastline=31]{\sol{002}{c}/solution.c}
                \caption{A better solution}
            \end{figure}

            \TODO{What's the total runtime complexity? It's logarithmic in $k$ but what's the relation between $n$ and $k$?}

            % This should give better precision:
            %\[ n(F_n) = \log_{\varphi}\left(\frac{F_n\sqrt{5} + \sqrt{5F_n^2 \pm 4}}{2}\right) \]
        \end{solution}
    \end{solutions}
\end{prob}

\end{document}
